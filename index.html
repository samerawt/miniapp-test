<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Laptop Store - Premium</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    
    <style>
        :root {
            --bg-dark: #091D34;
            --accent-blue: #67B3FB;
            --gold: #F4D68B;
            --card-bg: rgba(255, 255, 255, 0.05);
            --white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            background-color: var(--bg-dark);
            color: var(--white);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø­Ø³Ù† */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-dark);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(103, 179, 251, 0.2);
        }

        .brand-title {
            color: var(--accent-blue);
            font-weight: bold;
            margin: 0;
            font-size: 1.2rem;
        }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 15px;
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø·ÙˆØ±Ø© */
        .product-card {
            background: var(--card-bg);
            border-radius: 15px;
            border: 1px solid rgba(103, 179, 251, 0.1);
            display: flex;
            flex-direction: column;
            position: relative;
            transition: transform 0.2s;
        }

        .product-card:active { transform: scale(0.97); }

        .img-container {
            width: 100%;
            height: 110px;
            position: relative;
            background: #152a41;
            border-radius: 15px 15px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .status-badge {
            position: absolute;
            top: 8px; right: 8px;
            font-size: 0.65rem;
            padding: 3px 7px;
            border-radius: 5px;
            font-weight: bold;
            z-index: 2;
        }

        .in-stock { background: var(--gold); color: var(--bg-dark); }
        .out-stock { background: #ff4d4d; color: white; }

        .info { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; }
        
        .p-name { font-size: 0.85rem; height: 38px; margin-bottom: 8px; font-weight: 500; overflow: hidden; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ù…ØµØºØ± */
        .mini-specs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            background: rgba(103, 179, 251, 0.08);
            padding: 6px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .spec { font-size: 0.6rem; display: flex; align-items: center; gap: 3px; color: #b0c4d8; white-space: nowrap; overflow: hidden; }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .price { color: var(--gold); font-weight: bold; font-size: 1rem; }

        /* Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„ÙÙ„ØªØ± */
        .bottom-sheet {
            position: fixed;
            bottom: -100%; left: 0; right: 0;
            background: var(--bg-dark);
            border-radius: 25px 25px 0 0;
            z-index: 1001;
            padding: 25px;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-top: 2px solid var(--accent-blue);
            max-height: 70vh; overflow-y: auto;
        }

        .bottom-sheet.active { bottom: 0; }

        .overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none; z-index: 1000;
        }

        .lang-switch {
            background: transparent; border: 1px solid var(--accent-blue);
            color: var(--accent-blue); border-radius: 5px; padding: 4px 8px;
            cursor: pointer;
        }

        .filter-section { margin-bottom: 20px; }
        .filter-title { font-size: 0.9rem; color: var(--gold); margin-bottom: 10px; border-bottom: 1px solid #1a3a5a; padding-bottom: 5px; }
        
        [dir="ltr"] { text-align: left; }
        [dir="rtl"] { text-align: right; }
    </style>
</head>
<body>

<header>
    <button class="lang-switch" onclick="toggleLang()">EN / Ø¹Ø±Ø¨ÙŠ</button>
    <h1 class="brand-title" id="app-title">Ù…ØªØ¬Ø± Ø§Ù„Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª</h1>
    <button onclick="openFilter()" style="background:none; border:none; font-size: 1.5rem; color:var(--accent-blue); cursor:pointer">ğŸ”</button>
</header>

<div class="products-grid" id="productsContainer">
    </div>

<div class="overlay" id="overlay" onclick="closeFilter()"></div>
<div class="bottom-sheet" id="filterSheet">
    <div class="filter-section" id="filter-content">
        <div class="filter-title" id="filter-brand-label">Ø§Ù„Ø´Ø±ÙƒØ© / Brand</div>
        <div id="brand-filters"></div>
        <br>
        <div class="filter-title" id="filter-tag-label">Ø§Ù„ØªØµÙ†ÙŠÙ / Tag</div>
        <div id="tag-filters"></div>
    </div>
    <button onclick="closeFilter()" style="width:100%; padding:12px; background:var(--accent-blue); color:var(--bg-dark); border:none; border-radius:10px; font-weight:bold; cursor:pointer">ØªØ·Ø¨ÙŠÙ‚ / Apply</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù…Ù† Ù…Ø³ØªÙˆØ¯Ø¹Ùƒ
    const BASE_URL = "https://raw.githubusercontent.com/samerawt/miniapp-test/main/";
    const FILES = {
        laptops: BASE_URL + "Laptops.xlsx%20-%20LAPTOP.csv",
        tags: BASE_URL + "Laptops.xlsx%20-%20TAGS.csv"
    };

    let currentLang = 'ar';
    let laptopData = [];
    let tagsMap = {};

    const i18n = {
        ar: { title: "Ù…ØªØ¬Ø± Ø§Ù„Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª", cpu: "Ù…Ø¹Ø§Ù„Ø¬", ram: "Ø±Ø§Ù…", gpu: "ÙƒØ±Øª", hard: "Ù‡Ø§Ø±Ø¯", price: "$", in_stock: "Ù…ØªÙˆÙØ±", out_stock: "Ù†ÙØ°" },
        en: { title: "Laptop Store", cpu: "CPU", ram: "RAM", gpu: "GPU", hard: "Disk", price: "$", in_stock: "In Stock", out_stock: "Out" }
    };

    function toggleLang() {
        currentLang = currentLang === 'ar' ? 'en' : 'ar';
        document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
        renderApp();
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    async function initData() {
        // Ø¬Ù„Ø¨ Ø§Ù„Ù€ Tags Ø£ÙˆÙ„Ø§Ù‹
        Papa.parse(FILES.tags, {
            download: true,
            header: true,
            complete: (tagResults) => {
                tagResults.data.forEach(t => { if(t.Tag_ID) tagsMap[t.Tag_ID] = t.Tags; });
                
                // Ø¬Ù„Ø¨ Ø§Ù„Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª
                Papa.parse(FILES.laptops, {
                    download: true,
                    header: true,
                    complete: (laptopResults) => {
                        laptopData = laptopResults.data.filter(item => item.Laptop_ID);
                        renderApp();
                    }
                });
            }
        });
    }

    function renderApp() {
        const container = document.getElementById('productsContainer');
        const lang = i18n[currentLang];
        document.getElementById('app-title').innerText = lang.title;
        
        container.innerHTML = laptopData.map(item => {
            const isAvailable = item.STATE === 'IN STOCK';
            // Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù€ ID
            const imgUrl = `${BASE_URL}images/${item.Laptop_ID}_main.jpg`;
            
            return `
                <div class="product-card" onclick="openDetails('${item.Laptop_ID}')">
                    <div class="img-container">
                        <span class="status-badge ${isAvailable ? 'in-stock' : 'out-stock'}">
                            ${isAvailable ? lang.in_stock : lang.out_stock}
                        </span>
                        <img src="${imgUrl}" class="product-img" onerror="this.src='https://via.placeholder.com/150?text=Laptop'">
                    </div>
                    <div class="info">
                        <div class="p-name">${item.NAME}</div>
                        <div class="mini-specs">
                            <div class="spec">ğŸ“Ÿ ${item.CPU.split(' ')[0]}</div>
                            <div class="spec">ğŸ® ${item.GPU.split(' ')[0]}</div>
                            <div class="spec">âš¡ ${item.RAM}</div>
                            <div class="spec">ğŸ’¾ ${item.HARD.split(' ')[0]}</div>
                        </div>
                        <div class="price-row">
                            <div class="price">${lang.price}${item.PRICE}</div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function openDetails(id) {
        tg.showAlert("ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù‡Ø§Ø² Ø±Ù‚Ù…: " + id + "\nØ³ÙŠØªÙ… ÙØªØ­ ØµÙØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.");
    }

    function openFilter() {
        document.getElementById('filterSheet').classList.add('active');
        document.getElementById('overlay').style.display = 'block';
    }

    function closeFilter() {
        document.getElementById('filterSheet').classList.remove('active');
        document.getElementById('overlay').style.display = 'none';
    }

    initData();
</script>
</body>
</html>